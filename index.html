<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智识与审美课程成绩查询</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
        }
        
        .rules-section {
            background: #34495e;
            color: white;
            padding: 15px;
            font-size: 0.9em;
        }
        
        .rules-section h3 {
            margin-bottom: 10px;
            text-align: center;
        }
        
        .rules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .rule-item {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 5px;
        }
        
        .search-section {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .search-form {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .input-group {
            flex: 1;
            min-width: 200px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #495057;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .search-btn {
            align-self: flex-end;
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .search-btn:hover {
            transform: translateY(-2px);
        }
        
        .result-section {
            padding: 30px;
            display: none;
        }
        
        .student-info {
            background: #e8f4fd;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #3498db;
        }
        
        .scores-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .score-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
            border-top: 4px solid;
        }
        
        .quiz-total {
            border-top-color: #3498db;
        }
        
        .attendance-score {
            border-top-color: #f39c12;
        }
        
        .final-score {
            border-top-color: #2ecc71;
        }
        
        .score-card h3 {
            margin-bottom: 10px;
            font-size: 1.1em;
            color: #555;
        }
        
        .score-value {
            font-size: 2.2em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .score-details {
            font-size: 0.9em;
            color: #666;
            margin-top: 10px;
        }
        
        .scores-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .scores-table th {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        .scores-table td {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .scores-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .scores-table tr:hover {
            background-color: #e8f4fd;
        }
        
        .attendance-present {
            color: #27ae60;
            font-weight: bold;
        }
        
        .attendance-absent {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .attendance-leave {
            color: #f39c12;
            font-weight: bold;
        }
        
        .score-value {
            text-align: center;
            font-weight: bold;
        }
        
        .top-score {
            background-color: #d4edda !important;
            border-left: 4px solid #28a745;
        }
        
        .error-message {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin-top: 20px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        @media (max-width: 768px) {
            .search-form {
                flex-direction: column;
            }
            
            .scores-table {
                font-size: 14px;
            }
            
            .scores-table th,
            .scores-table td {
                padding: 10px 5px;
            }
            
            .score-value {
                font-size: 1.8em;
            }
            
            .rules-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>智识与审美课程成绩查询</h1>
            <p>请输入姓名和学号（或校名）查询您的课程成绩详情</p>
        </div>
        
        <div class="rules-section">
            <h3>成绩计算规则</h3>
            <div class="rules-grid">
                <div class="rule-item">
                    <strong>测验总分：</strong>最高四次测验成绩的总和×15%（保留一位小数）
                </div>
                <div class="rule-item">
                    <strong>考勤分：</strong>缺勤（不含请假）1~3次为-1分，4~7次为-2分
                </div>
                <div class="rule-item">
                    <strong>总分：</strong>测验总分 + 考勤分
                </div>
            </div>
        </div>
        
        <div class="search-section">
            <form class="search-form" id="searchForm">
                <div class="input-group">
                    <label for="name">姓名</label>
                    <input type="text" id="name" placeholder="请输入您的姓名" required>
                </div>
                <div class="input-group">
                    <label for="id">学号/校名</label>
                    <input type="text" id="id" placeholder="请输入您的学号/校名" required>
                </div>
                <button type="submit" class="search-btn">查询成绩</button>
            </form>
        </div>
        
        <div class="result-section" id="resultSection">
            <div class="loading" id="loadingMessage">正在加载数据...</div>
            <div id="contentArea" style="display: none;">
                <div class="student-info" id="studentInfo"></div>
                <div class="scores-summary" id="scoresSummary"></div>
                <table class="scores-table" id="scoresTable">
                    <thead>
                        <tr>
                            <th>周次</th>
                            <th>考勤状态</th>
                            <th>测验成绩</th>
                            <th>备注</th>
                        </tr>
                    </thead>
                    <tbody id="scoresBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // 加载成绩数据
        let courseData = null;
        
        // 页面加载时获取数据
        document.addEventListener('DOMContentLoaded', function() {
            fetch('course_scores.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('网络响应不正常');
                    }
                    return response.json();
                })
                .then(data => {
                    courseData = data;
                    console.log('课程数据加载成功，共', data.students.length, '名学生');
                    document.getElementById('loadingMessage').style.display = 'none';
                })
                .catch(error => {
                    console.error('加载数据失败:', error);
                    document.getElementById('loadingMessage').innerHTML = 
                        '数据加载失败，请刷新页面重试<br>错误信息: ' + error.message;
                });
        });

        // 处理表单提交
        document.getElementById('searchForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('name').value.trim();
            const id = document.getElementById('id').value.trim();
            
            if (!courseData) {
                alert('数据正在加载中，请稍后再试');
                return;
            }
            
            // 查找学生
            const student = courseData.students.find(s => 
                s.name === name && s.id.toString() === id
            );
            
            const resultSection = document.getElementById('resultSection');
            const contentArea = document.getElementById('contentArea');
            const studentInfo = document.getElementById('studentInfo');
            const scoresSummary = document.getElementById('scoresSummary');
            const scoresBody = document.getElementById('scoresBody');
            
            resultSection.style.display = 'block';
            document.getElementById('loadingMessage').style.display = 'none';
            
            if (student) {
                contentArea.style.display = 'block';
                
                // 显示学生信息
                studentInfo.innerHTML = `
                    <h3>${student.name} 同学</h3>
                    <p>学号: ${student.id}</p>
                    <p>数据更新时间: ${courseData.last_updated}</p>
                `;
                
                // 计算最高四次成绩
                const validScores = Object.entries(student.scores)
                    .filter(([week, score]) => score !== null && score !== undefined)
                    .map(([week, score]) => ({ week, score }));
                
                // 按成绩排序，取前四名
                const topScores = [...validScores]
                    .sort((a, b) => b.score - a.score)
                    .slice(0, 4);
                
                // 显示成绩摘要卡片
                scoresSummary.innerHTML = `
                    <div class="score-card quiz-total">
                        <h3>测验总分</h3>
                        <div class="score-value">${student.quiz_total} / 60</div>
                        <div class="score-details">
                            基于 ${validScores.length} 次有效测验成绩<br>
                            最高四次: ${topScores.map(s => s.score).join(' + ')} = ${topScores.reduce((sum, s) => sum + s.score, 0)}<br>
                            ${topScores.reduce((sum, s) => sum + s.score, 0)} × 15% = ${student.quiz_total}
                        </div>
                    </div>
                    <div class="score-card attendance-score">
                        <h3>考勤分</h3>
                        <div class="score-value">${student.attendance_score}</div>
                        <div class="score-details">
                            缺勤 ${student.absent_count} 次<br>
                            ${student.absent_count === 0 ? '无缺勤，不扣分' : 
                              student.absent_count <= 3 ? '1~3次缺勤，扣1分' : 
                              '4~7次缺勤，扣2分'}
                        </div>
                    </div>
                    <div class="score-card final-score">
                        <h3>总分</h3>
                        <div class="score-value">${student.total_score}</div>
                        <div class="score-details">
                            测验总分 + 考勤分<br>
                            ${student.quiz_total} ${student.attendance_score >= 0 ? '+' : ''} ${student.attendance_score} = ${student.total_score}
                        </div>
                    </div>
                `;
                
                // 显示详细成绩
                scoresBody.innerHTML = '';
                const weeks = [
                    { key: 'week3', name: '第三周' },
                    { key: 'week6', name: '第六周' },
                    { key: 'week8', name: '第八周' },
                    { key: 'week10', name: '第十周' },
                    { key: 'week12', name: '第十二周' },
                    { key: 'week14', name: '第十四周' },
                    { key: 'week16', name: '第十六周' }
                ];
                
                weeks.forEach(week => {
                    const attendance = student.attendance[week.key];
                    const score = student.scores[week.key];
                    const isTopScore = topScores.some(s => s.week === week.key);
                    
                    let attendanceClass = '';
                    let attendanceText = attendance;
                    
                    if (attendance === '出勤') {
                        attendanceClass = 'attendance-present';
                    } else if (attendance === '缺勤') {
                        attendanceClass = 'attendance-absent';
                    } else if (attendance === '请假') {
                        attendanceClass = 'attendance-leave';
                    }
                    
                    const row = document.createElement('tr');
                    if (isTopScore) {
                        row.className = 'top-score';
                    }
                    
                    row.innerHTML = `
                        <td>${week.name}</td>
                        <td class="${attendanceClass}">${attendanceText || '--'}</td>
                        <td class="score-value">${score !== null && score !== undefined ? score : '--'}</td>
                        <td>${isTopScore ? '✅ 计入测验总分' : (score !== null && score !== undefined ? '未计入最高四次' : '无成绩')}</td>
                    `;
                    scoresBody.appendChild(row);
                });
                
            } else {
                contentArea.style.display = 'none';
                document.getElementById('loadingMessage').innerHTML = `
                    <div class="error-message">
                        未找到匹配的学生信息，请检查姓名和学号是否正确<br>
                        已加载 ${courseData.students.length} 名学生数据<br>
                        最后更新: ${courseData.last_updated}
                    </div>
                `;
                document.getElementById('loadingMessage').style.display = 'block';
            }
            
            // 滚动到结果区域
            resultSection.scrollIntoView({ behavior: 'smooth' });
        });
    </script>
</body>
</html>
